{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-4">
    {% if form.errors %}
    <div id="error-box" class="alert alert-danger" style="background:#ffe5e5; border:2px solid #d32f2f; color:#d32f2f; padding:16px; border-radius:8px; margin-bottom:20px;">
        <strong>Por favor corrige los siguientes errores:</strong>
        <ul class="mb-0" style="margin-top:10px;">
        {% for field, errors in form.errors.items %}
            {% for error in errors %}
                <li><strong>
                    {% if field == 'payment_type' %}Tipo de Método de Pago
                    {% elif field == 'titular_cuenta' %}Nombre del titular
                    {% elif field == 'tipo_cuenta' %}Tipo de cuenta
                    {% elif field == 'banco' %}Banco
                    {% elif field == 'numero_cuenta' %}Número de cuenta o IBAN
                    {% elif field == 'proveedor_billetera' %}Proveedor
                    {% elif field == 'billetera_email_telefono' %}Email o teléfono asociado
                    {% elif field == 'billetera_titular' %}Nombre del titular (opcional)
                    {% elif field == 'tarjeta_nombre' %}Nombre en tarjeta
                    {% elif field == 'tarjeta_numero' %}Número de tarjeta
                    {% elif field == 'tarjeta_vencimiento' %}Fecha de vencimiento
                    {% elif field == 'tarjeta_cvv' %}CVV/CVC
                    {% elif field == 'tarjeta_marca' %}Marca de tarjeta
                    {% elif field == 'cheque_numero' %}Número de cheque
                    {% elif field == 'cheque_banco' %}Banco
                    {% elif field == 'cheque_cuenta' %}Cuenta
                    {% elif field == 'cheque_orden' %}Orden (Casa Matriz, dirección incluida)
                    {% elif field == 'cheque_beneficiario' %}Beneficiario
                    {% elif field == 'cheque_monto' %}Monto
                    {% elif field == 'cheque_moneda' %}Moneda
                    {% elif field == 'cheque_fecha_emision' %}Fecha de emisión
                    {% else %}{{ field|capfirst }}
                    {% endif %}
                :</strong> {{ error }}</li>
            {% endfor %}
        {% endfor %}
        {% if form.non_field_errors %}
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        {% endif %}
        </ul>
    </div>
    {% endif %}
    <h2>{% if method %}Editar{% else %}Nuevo{% endif %} Método de Pago</h2>
    <form method="post">
        {% csrf_token %}
        {% if cliente %}
            <div class="mb-3">
                <label class="form-label fw-bold">Cliente</label>
                <input type="text" class="form-control" value="{{ cliente.nombre }}" readonly>
            </div>
        {% endif %}
        <div class="mb-3">
            <label for="id_payment_type" class="form-label fw-bold">Tipo de Método de Pago</label>
            {% if method %}
                <input type="text" class="form-control" readonly value="{{ method.get_payment_type_display }}">
                <input type="hidden" name="payment_type" value="{{ form.payment_type.value }}">
            {% else %}
                {{ form.payment_type }}
            {% endif %}
        </div>
        <div id="campos-tarjeta" style="display:none;">
            <div class="mb-3"><label class="form-label">Nombre en tarjeta</label>{{ form.tarjeta_nombre }}</div>
            <div class="mb-3"><label class="form-label">Número de tarjeta</label>{{ form.tarjeta_numero }}</div>
            <div class="mb-3"><label class="form-label">Fecha de vencimiento</label>{{ form.tarjeta_vencimiento }}</div>
            <div class="mb-3"><label class="form-label">CVV/CVC</label>{{ form.tarjeta_cvv }}</div>
            <div class="mb-3"><label class="form-label">Marca de tarjeta</label>{{ form.tarjeta_marca }}</div>
        </div>
        <div id="campos-cuenta" style="display:none;">
            <div class="mb-3"><label class="form-label">Nombre del titular</label>{{ form.titular_cuenta }}</div>
            <div class="mb-3"><label class="form-label">Tipo de cuenta</label>{{ form.tipo_cuenta }}</div>
            <div class="mb-3"><label class="form-label">Banco</label>{{ form.banco }}</div>
            <div class="mb-3"><label class="form-label">Número de cuenta o IBAN</label>{{ form.numero_cuenta }}</div>
        </div>
        <div id="campos-billetera" style="display:none;">
            <div class="mb-3"><label class="form-label">Proveedor</label>{{ form.proveedor_billetera }}</div>
            <div class="mb-3"><label class="form-label">Email o teléfono asociado</label>{{ form.billetera_email_telefono }}</div>
            <div class="mb-3"><label class="form-label">Nombre del titular (opcional)</label>{{ form.billetera_titular }}</div>
        </div>
        <div id="campos-cheque" style="display:none;">
            <div class="mb-3"><label class="form-label">Banco</label>{{ form.cheque_banco }}</div>
            <div class="mb-3"><label class="form-label">Cuenta</label>{{ form.cheque_cuenta }}</div>
            <div class="mb-3"><label class="form-label">Número de cheque</label>{{ form.cheque_numero }}</div>
            <div class="mb-3"><label class="form-label">Orden (Casa Matriz, dirección incluida)</label>{{ form.cheque_orden }}</div>
            <div class="mb-3"><label class="form-label">Beneficiario</label>{{ form.cheque_beneficiario }}</div>
            <div class="mb-3"><label class="form-label">Monto</label>{{ form.cheque_monto }}</div>
            <div class="mb-3"><label class="form-label">Moneda</label>{{ form.cheque_moneda }}</div>
            <div class="mb-3"><label class="form-label">Fecha de emisión</label>{{ form.cheque_fecha_emision }}</div>
        </div>
        <!-- campos-generales eliminados: ya no existen en el modelo ni en el form -->
        <button type="submit" class="btn btn-success">Guardar</button>
    <a href="{% url 'payments:payment_methods_by_client' %}" class="btn btn-secondary">Cancelar</a>
        <script src="{% static 'payments/payment_form_restrict.js' %}"></script>
    </form>
</div>
{% endblock %}
